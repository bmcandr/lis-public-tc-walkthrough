== {title_step1}
anchor:sec_step1[{title_step1}]

:ldtconfig-filename: ldt.config.noah36_params

=== Overview

In this step you will learn how to run LDT to perform parameter processing for the Noah-3.6 land surface model (LSM) and generate a Noah-3.6 parameter input file to be used by LIS (and LVT) in later steps.

NOTE: These testcases were designed to be run in sequential order and later steps require the output generated by earlier steps.

==== Steps to Running LDT

. Compile the LDT source code to generate the LDT executable (see <<sec_setup>>)
. Collect input data needed by LDT
. Modify `ldt.config` file to define runtime configuration settings
. Run the LDT executable
. Examine output

=== Download Input Files

The input files are available on the {url-lis-testcases}[LIS Testcase website]. While within your $WORKING_DIR, download and unpack the compressed tar file containing the inputs for Step 1:

[#download-step1]
[source,bash,subs="attributes"]
----
% curl -O {url-lis-testcase-files}{step1-filename}
% tar -xzf {step1-filename}
----

WARNING: The compressed tar file for this step is approximately 350MB compressed and 4.1GB uncompressed. Ensure that you have enough storage available before downloading testcase files.

In addition to the `LISF/` repository, your `$WORKING_DIR` will now contain the following directory and files:

[cols="2*",frame=topbot,stripes=odd]
[%autowidth]
|===
|`INPUT/` |A directory that will hold parameter and input files needed throughout the testcases
|`{ldtconfig-filename}` |The runtime configuration file read by LDT in this step
|`target_lis_input.nldas.noah36.d01.nc` |The "target" NetCDF file generated by LDT in this step
|`target_MaskParamFill.log` |The "target" mask-parameter log generated by LDT in this step
|===

Each of the files beginning with `target` are provided to compare with the output of your run. Use command-line tools such as `diff` and `nccmp` for these comparisons.

==== The LDT Configuration File

The LDT configuration file (`{ldtconfig-filename}`) contains input settings used by LDT at run-time to generate input files for LIS. The configuration options are described in depth in the {url-official-docs}[official documentation].

Before continuing, review the contents of the LDT configuration file for our LDT-based NOAH.3.6 parameter test case:

[#cat-ldtconfig]
[source,bash]
----
% cat ldt.config

#Overall driver options
LDT running mode:                       "LSM parameter processing"
Processed LSM parameter filename:       ./lis_input.nldas.noah36.d01.nc # <1>
LIS number of nests:                    1
Number of surface model types:          2
Surface model types:                    "LSM" "Openwater"
Land surface model:                     "Noah.3.6" <2>
Lake model:                             none
Water fraction cutoff value:            0.5

Number of met forcing sources:          0
Met forcing sources:                    "NLDAS2"
Met spatial transform methods:          "neighbor"  # bilinear
Topographic correction method (met forcing):  "lapse-rate"
Temporal interpolation method (met forcing): linear
LDT diagnostic file:                    ldtlog <3>
LDT output directory:                   OUTPUT <4>
Undefined value:                       -9999.0

# ...

#LIS domain <5>
Map projection of the LIS domain:      latlon
Run domain lower left lat:             34.375
Run domain lower left lon:            -102.875
Run domain upper right lat:            39.625
Run domain upper right lon:           -96.125
Run domain resolution (dx):             0.25
Run domain resolution (dy):             0.25

# Parameters
Landcover data source:        MODIS_Native <6>
Landcover classification:       IGBPNCEP
Landcover file:            ./INPUT/LS_PARAMETERS/noah_2dparms/igbp.bin
Landcover spatial transform:     tile
Landcover fill option:           none # Set to none if creating land mask
Landcover map projection:       latlon

Create or readin landmask:    create
Landmask data source:         MODIS_Native
Landmask spatial transform:   none
# ...
----
<1> The name of the NetCDF-formatted parameter file to be generated which will be used by LIS
<2> The LSM of interest (e.g., https://ral.ucar.edu/solutions/products/noah-multiparameterization-land-surface-model-noah-mp-lsm[Noah.3.6])
<3> The name of the diagnostic log file
<4> The directory where LDT output will be placed
<5> The grid projection, domain extents, and spatial resolution to be used by LIS (and LVT)
<6> Data source settings and paths (e.g., landcover datasets, elevation datasets) and additional features of interest (e.g., irrigation settings)

The grid domain defined in the `ldt.config` file will be placed in the NetCDF-formatted parameter file generated by LDT which LIS will read in automatically at run-time. For these testcases we will be using the domain depicted below:

[#domain-spec]
[.float-group]
.Testcase domain specification:
--
image::step_1_domain_map.png[width=85%, float="right"]

[cols=".^h,^,^", options="header", frame=none]
[%autowidth]
|===
||Longitude|Latitude
|Lower left|-102.875|34.375
|Upper right|-96.125|39.625
|Resolution|0.25ยบ|0.25ยบ
|===
--

==== Files Generated by an LDT Parameter Processing Run

The following files are typically generated by an LDT parameter processing run. This type of run is used to create the files required to run LIS.

* `lis_input.d01.nc`
** The NetCDF-formatted model parameter file, which is read into LIS at runtime. `d01` refers to the indexed domain, typically used as "nests" for NASA-Unified WRF simulations.
* `lislog.0000`
** The output diagnostic file that provides runtime messages, including warnings and error messages. This file is useful for verifying successful run completion and troubleshooting unsuccessful runs.
* `MaskParamFill.log`
** This diagnostic file informs of any disagreements between an LSM-based parameter and the landmask, and whether any parameter gridcells were "filled" to agree with the landmask.